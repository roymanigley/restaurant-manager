import{a as b,b as P}from"./chunk-MZ4LUD7G.js";import"./chunk-TSIVVEAZ.js";import{$a as x,Ab as L,Ba as E,C as p,Ha as c,J as a,K as s,L as l,N as D,Sa as T,T as f,Ta as B,Wa as g,Xa as M,Ya as F,Za as N,_a as j,ab as w,bb as k,cb as O,db as U,h,hb as _,ib as V,j as S,k as v,n as C,o as y,pa as I,s as G,v as m,vb as A,w as u}from"./chunk-ZVRC6D75.js";var q=(()=>{class r extends P{getBaseUrl(){return"/api/staff/orders"}getDateFields(){return["date"]}fetchTableStats(e,o){return this.http.get(`${this.getBaseUrl()}/`,{params:{offset:0,limit:99999,start:b.fromDateToUtcIsoString(e).substring(0,10),end:b.fromDateToUtcIsoString(o).substring(0,10),state:"COMPLETED"}}).pipe(h(t=>t.results.forEach(n=>this.mapStringsToDate(n))))}static{this.\u0275fac=(()=>{let e;return function(t){return(e||(e=G(r)))(t||r)}})()}static{this.\u0275prov=S({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var $=(()=>{class r{constructor(e,o){this.statisticService=e,this.formBuilder=o,this.data={},this.formGroup=this.formBuilder.group({start:[new Date,[g.required]],end:[new Date,[g.required]]})}ngOnInit(){let e=getComputedStyle(document.documentElement),o=e.getPropertyValue("--text-color"),t=e.getPropertyValue("--text-color-secondary"),n=e.getPropertyValue("--surface-border");this.options={maintainAspectRatio:!1,aspectRatio:.8,plugins:{tooltip:{mode:"index",intersect:!1},legend:{labels:{color:o}}},scales:{x:{stacked:!0,ticks:{color:t},grid:{color:n,drawBorder:!1}},y:{stacked:!0,ticks:{color:t},grid:{color:n,drawBorder:!1}}}},this.loadChart()}loadChart(){this.formGroup.valid&&this.statisticService.fetchTableStats(this.formGroup.value.start,this.formGroup.value.end).subscribe(e=>{console.log(e.results);let o=new Set(e.results.map(i=>i.date?.toISOString().substring(0,10)));console.log(o);let t={};e.results.forEach(i=>{let d=i.table_name;t[d]||(t[d]={},o.forEach(z=>t[d][z]=0)),t[d][i.date.toISOString().substring(0,10)]+=i.amount*i.price_per_item});let n=Object.keys(t).map(i=>({type:"bar",label:i,data:Object.values(t[i])}));console.log(n),this.data={labels:[...o],datasets:n}})}static{this.\u0275fac=function(o){return new(o||r)(u(q),u(w))}}static{this.\u0275cmp=C({type:r,selectors:[["app-table-statistic"]],decls:22,vars:6,consts:[["header","Statistics"],[3,"ngSubmit","formGroup"],[1,"grid","gap-2"],[1,"lg:col-3","md:col-4","col-12"],[1,"pi","pi-calendar"],["id","start","formControlName","start",3,"maxDate"],["for","start"],["id","end","formControlName","end",3,"minDate"],["for","end"],[1,"col-1"],["icon","pi pi-check","type","subit",3,"disabled"],["type","bar",3,"data","options"]],template:function(o,t){o&1&&(a(0,"p-card",0)(1,"form",1),D("ngSubmit",function(){return t.loadChart()}),a(2,"div",2)(3,"div",3)(4,"p-inputGroup")(5,"p-inputGroupAddon"),l(6,"i",4),s(),a(7,"p-floatLabel"),l(8,"p-calendar",5),a(9,"label",6),f(10,"Start"),s()()()(),a(11,"div",3)(12,"p-inputGroup")(13,"p-inputGroupAddon"),l(14,"i",4),s(),a(15,"p-floatLabel"),l(16,"p-calendar",7),a(17,"label",8),f(18,"End"),s()()()(),a(19,"div",9),l(20,"p-button",10),s()()(),l(21,"p-chart",11),s()),o&2&&(m(),p("formGroup",t.formGroup),m(7),p("maxDate",t.formGroup.value.end),m(8),p("minDate",t.formGroup.value.start),m(4),p("disabled",t.formGroup.invalid),m(),p("data",t.data)("options",t.options))},dependencies:[c,T,k,O,U,N,M,F,A,j,x,_]})}}return r})();var J=[{path:"table",component:$}],ft=(()=>{class r{static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275mod=y({type:r})}static{this.\u0275inj=v({imports:[E.forChild(J),I,c,B,L,V]})}}return r})();export{ft as StatisticsModule};
